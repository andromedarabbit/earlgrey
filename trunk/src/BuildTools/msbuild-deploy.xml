<Project DefaultTargets="Deploy" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

<PropertyGroup>
	<Configuration Condition=" '$(Configuration)' == '' ">Release</Configuration>
	<Configuration Condition=" '$(BuildCondition)' == '' ">Rebuild</Configuration>
</PropertyGroup>

<Import Project="msbuild.xml"/>

<!-- 배포 폴더 -->
<PropertyGroup>
	<DeploymentDir Condition="'$(DeploymentDir)' == ''">$(OutputDir)\MSBuildExtension</DeploymentDir>
</PropertyGroup>

<!-- 배포 파일 -->
<Target Name="GetMSBuildExtensionFileList">
	<CreateItem
		Include="$(BinDir)\MSBuild.*.Tasks.*; $(BinDir)\ICSharpCode.SharpZipLib.dll"
		Exclude="$(BinDir)\MSBuild.*.Tests.*"
		AdditionalMetadata="DstDir=$(DeploymentDir)"
	>

		<Output
			TaskParameter="Include"
			ItemName="MSBuildExtensionFile"
		/>
	</CreateItem>
	
	<CreateItem
		Include="$(BinDir)\ExternalTools\*"
		AdditionalMetadata="DstDir=$(DeploymentDir)\ExternalTools"
	>
		<Output
			TaskParameter="Include"
			ItemName="MSBuildExtensionFile"
		/>
	</CreateItem>
</Target>

<Target Name="Deploy" DependsOnTargets="$(BuildCondition); GetMSBuildExtensionFileList">
	<Exec Command="rmdir /s $(Quot)$(DeploymentDir)$(Quot)" />
	
	<Copy      
      DestinationFolder="%(MSBuildExtensionFile.DstDir)"
      SourceFiles="%(MSBuildExtensionFile.FullPath)"
	/>
	
	<Message Text="@(MSBuildExtensionFile)" Importance="high" />
</Target>

</Project>
