<?xml version="1.0" encoding="utf-8"?>
<Project 
	InitialTargets="RunTest-ZipAFolderUsing7Zip"
	xmlns="http://schemas.microsoft.com/developer/msbuild/2003"
	>

<Import Project="msbuild-configurations.xml" />
	
<!--
MSBuild.Earlgrey.Tasks.IO.Compression.SevenZip.Pack

Required
* SrcFolder (*.zip, *.7z and others): The source folder to be compressed.
* ZipFilePath: The destination file.


Optional
* Excludes: Pattern strings. For instance, Excludes="*.txt; *.log".
* Overwrite (true/false, default: false): If true, overwrite an old file with new one if the file named ZipFilePath exists.
* ZipLevel (0, 1, ... ,8 ,9): Higher number, higher compression rate.
* Password
* ContainsRootDir (default: true): If true, the root folder of SrcFolder will also be compressed into ZipFilePath.

* UseLargePages (default: true): Turn on -slp switch of 7za.exe. See 7-zip user guide if you want details.
-->
<Target Name="ZipAFolder">
	<Delete Files="$(TempDir)\ZipAFolder.zip" />
	
	<!-- 
	Compress SrcFolder into ZipAFolder.zip, which contains all the sub-files and sub-folders except SrcFolder itself 
	-->
	<SevenZip.Pack 
		SrcFolder="$(RootDir)\Data" 
		ZipFilePath="$(TempDir)\ZipAFolder.zip" 
		ContainsRootDir="false"
		/>
</Target>


<!--
MSBuild.Earlgrey.Tasks.IO.Compression.SevenZip.Unpack

Required
* ZipFilePath: The source zip file.
* TargetDir: The folder where ZipFilePath will be decompressed into.

Optional
* Overwrite (true/false, default: false): If true, overwrite an old file/folder with new one if the same file/folder exists.
* Password
-->
<Target Name="UnzipAFolder">
	<RemoveDir Directories="$(TempDir)\Data" />
	
	<!-- 
	Decompress all the files and folders into TargetDir. Overwrite an old file/folder with new one if the same file/folder exists. 
	-->
	<SevenZip.Unpack 
		ZipFilePath="$(TempDir)\ZipAFolder.zip" 
		TargetDir="$(TempDir)\DstDir" 
		Overwrite="true"
	/>

	<Error 
		Text="A folder '$(TempDir)\DstDir' not found!" 
		Condition="!Exists('$(TempDir)\DstDir')"
		/>
	
	<RemoveDir Directories="$(TempDir)\Data" />
	
</Target>

<Target Name="RunTest-ZipAFolderUsing7Zip" DependsOnTargets="ZipAFolder; UnzipAFolder">
</Target>

</Project>

		